// script.js

const supabaseUrl = 'https://lopjgtlxicfgcdibmhdv.supabase.co'; // Substitua com o seu URL do Supabase
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxvcGpndGx4aWNmZ2NkaWJtaGR2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzNzM5MjksImV4cCI6MjA2Njk0OTkyOX0.1W33xBoOgKQkzp7tr3clW1NpcZlKRS3fO9AJ0MjAWus'; // Substitua com sua chave anônima
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

// Função para carregar chamadas em tempo real
async function carregarChamadas() {
    const { data, error } = await supabase
        .from('chamadas')
        .select('*')
        .order('created_at', { ascending: false });

    if (error) {
        console.error('Erro ao carregar chamadas:', error);
        return;
    }

    const listaChamadas = document.getElementById('lista-chamadas');
    listaChamadas.innerHTML = ''; // Limpa a lista antes de adicionar novos itens
    data.forEach(chamada => {
        const li = document.createElement('li');
        li.textContent = `${chamada.nome} - Sala: ${chamada.sala}`;
        listaChamadas.appendChild(li);
    });
}

// Função para carregar histórico de chamadas
async function carregarHistorico() {
    const { data, error } = await supabase
        .from('historico_chamadas')
        .select('*')
        .order('created_at', { ascending: false });

    if (error) {
        console.error('Erro ao carregar histórico:', error);
        return;
    }

    const listaHistorico = document.getElementById('historico-chamadas');
    listaHistorico.innerHTML = ''; // Limpa a lista antes de adicionar novos itens
    data.forEach(chamada => {
        const li = document.createElement('li');
        li.textContent = `${chamada.nome} - Sala: ${chamada.sala} - Data: ${chamada.data}`;
        listaHistorico.appendChild(li);
    });
}

// Carrega os dados quando o DOM estiver pronto
document.addEventListener('DOMContentLoaded', () => {
    carregarChamadas();
    carregarHistorico();
});
"Atualizar credenciais do Supabase"
// script.js (Parte da Área dos Profissionais)

const supabaseUrl = 'https://your-supabase-url.supabase.co'; // Substitua com o seu URL do Supabase
const supabaseKey = 'your-anon-key'; // Substitua com sua chave anônima
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

// Função para carregar os pacientes chamados para atendimento
async function carregarPacientesChamados() {
    const { data, error } = await supabase
        .from('chamadas')
        .select('*')
        .eq('status', 'chamado') // Verifica se o paciente foi chamado
        .order('created_at', { ascending: false });

    if (error) {
        console.error('Erro ao carregar pacientes chamados:', error);
        return;
    }

    const listaPacientesChamados = document.getElementById('lista-pacientes-chamados');
    listaPacientesChamados.innerHTML = ''; // Limpa a lista antes de adicionar novos pacientes

    // Adiciona os pacientes chamados à lista
    data.forEach(paciente => {
        const li = document.createElement('li');
        li.textContent = `${paciente.nome} - Sala: ${paciente.sala}`;
        listaPacientesChamados.appendChild(li);

        // Popula o seletor de pacientes para o profissional marcar como atendido
        const pacienteSelect = document.getElementById('paciente-profissional-id');
        const option = document.createElement('option');
        option.value = paciente.id;
        option.textContent = paciente.nome;
        pacienteSelect.appendChild(option);
    });
}

// Função para marcar o atendimento como concluído
async function marcarAtendimentoConcluido() {
    const pacienteId = document.getElementById('paciente-profissional-id').value;

    if (!pacienteId) {
        alert('Selecione um paciente');
        return;
    }

    // Atualizar o status do paciente para "atendido"
    const { data, error } = await supabase
        .from('chamadas')
        .update({ status: 'atendido' })
        .match({ id: pacienteId });

    if (error) {
        console.error('Erro ao marcar atendimento como concluído:', error);
        return;
    }

    alert('Atendimento concluído com sucesso!');

    // Atualiza a lista de pacientes chamados
    carregarPacientesChamados();
}

// Função para carregar o histórico de atendimentos
async function carregarHistoricoAtendimentos() {
    const { data, error } = await supabase
        .from('historico_atendimentos')
        .select('*')
        .order('created_at', { ascending: false });

    if (error) {
        console.error('Erro ao carregar histórico de atendimentos:', error);
        return;
    }

    const listaHistoricoAtendimentos = document.getElementById('historico-atendimentos-lista');
    listaHistoricoAtendimentos.innerHTML = ''; // Limpa a lista antes de adicionar novos históricos

    // Exibe o histórico de atendimentos
    data.forEach(atendimento => {
        const li = document.createElement('li');
        li.textContent = `${atendimento.nome} - Sala: ${atendimento.sala} - Data: ${atendimento.data}`;
        listaHistoricoAtendimentos.appendChild(li);
    });
}

// Configura os eventos ao carregar a página
document.addEventListener('DOMContentLoaded', () => {
    carregarPacientesChamados();
    carregarHistoricoAtendimentos();

    document.getElementById('atender-paciente').addEventListener('click', marcarAtendimentoConcluido);
});
// script.js (Parte da Área de Configurações)

const supabaseUrl = 'https://your-supabase-url.supabase.co'; // Substitua com o seu URL do Supabase
const supabaseKey = 'your-anon-key'; // Substitua com sua chave anônima
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

// Função para adicionar uma nova sala
async function adicionarSala() {
    const nomeSala = document.getElementById('nova-sala').value;
    
    if (!nomeSala) {
        alert('Digite o nome da sala');
        return;
    }

    const { data, error } = await supabase
        .from('salas')
        .insert([{ nome: nomeSala }]);

    if (error) {
        console.error('Erro ao adicionar sala:', error);
        return;
    }

    alert('Sala adicionada com sucesso!');
    carregarSalas();
}

// Função para carregar as salas existentes
async function carregarSalas() {
    const { data, error } = await supabase
        .from('salas')
        .select('*');

    if (error) {
        console.error('Erro ao carregar salas:', error);
        return;
    }

    const listaSalas = document.getElementById('lista-salas');
    listaSalas.innerHTML = ''; // Limpa a lista antes de adicionar novas salas

    data.forEach(sala => {
        const li = document.createElement('li');
        li.textContent = sala.nome;
        listaSalas.appendChild(li);
    });
}

// Função para adicionar um novo profissional
async function adicionarProfissional() {
    const nomeProfissional = document.getElementById('novo-profissional').value;

    if (!nomeProfissional) {
        alert('Digite o nome do profissional');
        return;
    }

    const { data, error } = await supabase
        .from('profissionais')
        .insert([{ nome: nomeProfissional }]);

    if (error) {
        console.error('Erro ao adicionar profissional:', error);
        return;
    }

    alert('Profissional adicionado com sucesso!');
    carregarProfissionais();
}

// Função para carregar os profissionais existentes
async function carregarProfissionais() {
    const { data, error } = await supabase
        .from('profissionais')
        .select('*');

    if (error) {
        console.error('Erro ao carregar profissionais:', error);
        return;
    }

    const listaProfissionais = document.getElementById('lista-profissionais');
    listaProfissionais.innerHTML = ''; // Limpa a lista antes de adicionar novos profissionais

    data.forEach(profissional => {
        const li = document.createElement('li');
        li.textContent = profissional.nome;
        listaProfissionais.appendChild(li);
    });
}

// Função para salvar configurações de notificações
async function salvarConfiguracoes() {
    const tipoNotificacao = document.getElementById('tipo-notificacao').value;

    const { data, error } = await supabase
        .from('configuracoes')
        .upsert([{ chave: 'tipo_notificacao', valor: tipoNotificacao }]);

    if (error) {
        console.error('Erro ao salvar configurações:', error);
        return;
    }

    alert('Configurações salvas com sucesso!');
}

// Configura os eventos ao carregar a página
document.addEventListener('DOMContentLoaded', () => {
    carregarSalas();
    carregarProfissionais();

    document.getElementById('adicionar-sala').addEventListener('click', adicionarSala);
    document.getElementById('adicionar-profissional').addEventListener('click', adicionarProfissional);
    document.getElementById('salvar-configuracoes').addEventListener('click', salvarConfiguracoes);
});
